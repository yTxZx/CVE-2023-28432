import argparse
import subprocess
import sys

def usage():
    print('''
        Usage:
            python uploadGithub.py -n <projectName>
    ''')

def uploadGithub(projectName):
    try:
        command1 = subprocess.Popen(['git init'],
                                    stdout=subprocess.PIPE, stderr=subprocess.PIPE, shell=True)
        print(command1.stdout.read().decode())
    except:
        print(command1.stderr.read().decode())
        exit(0)
    try:
        command2 = subprocess.Popen(['git add .'],
                                    stdout=subprocess.PIPE, stderr=subprocess.PIPE, shell=True)
        print(command2.stdout.read().decode())
    except:
        print(command2.stderr.read().decode())
        exit(0)
    try:
        command3 = subprocess.Popen(['git commit -m "project commit"'],
                                    stdout=subprocess.PIPE, stderr=subprocess.PIPE, shell=True)
        print(command3.stdout.read().decode())
    except:
        print(command3.stderr.read().decode())
        exit(0)
    try:
        command4 = subprocess.Popen(['git branch -M main'],
                                    stdout=subprocess.PIPE, stderr=subprocess.PIPE, shell=True)
        print(command4.stdout.read().decode())
    except:
        print(command4.stderr.read().decode())
        exit(0)
    try:
        command5 = subprocess.Popen(['git remote add origin git@github.com:yTxZx/' + projectName + '.git'],
                                    stdout=subprocess.PIPE, stderr=subprocess.PIPE, shell=True)
        print(command5.stdout.read().decode())
    except:
        print(command5.stderr.read().decode())
        exit(0)
    try:
        command6 = subprocess.Popen(['git push -u origin main'],
                                    stdout=subprocess.PIPE, stderr=subprocess.PIPE, shell=True)
        print(command6.stdout.read().decode())
    except:
        print(command6.stderr.read().decode())
        exit(0)
    print('Upload successfully!!!')

if __name__ == "__main__":
    try:
        parser = argparse.ArgumentParser(prog='Used to upload projects to github',
                                        description='python3 uploadGithub.py -n <projectName>')
        parser.add_argument('-n', '--projectName', type=str, help='Project name')
        args = parser.parse_args()
        projectName = args.projectName
    except Exception as e:
        print('Parameter input error')
        usage()
        sys.exit(0)
    uploadGithub(projectName)